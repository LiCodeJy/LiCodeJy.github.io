## Redis 缓存问题

缓存在数据库之前，请求会先去缓存中查询，缓存中没有再去数据库中查询

### 缓存穿透

例：双十一很多商品一起秒杀

用户频繁请求缓存和数据库中都没有的数据，导致每次都会请求到数据库，从而压跨数据库

#### 解决方案

1. 业务层校验

   对于明显错误的请求参数进行校验，直接拦截返回

2. 缓存空结果并设置短过期时间

   将空结果进行 redis 缓存，但是设置的过期时间很短，防止影响正常业务

3. **布隆过滤器**（下面）

   布隆过滤器是一种数据结构，利用极小的内存，可以判断大量的数据“一定不存在或者可能存在”

### 缓存击穿

例：微博热搜导致宕机

某个热点key失效的瞬间，大量请求过来，全部到达数据库从而压跨数据库

#### 解决方案

1. 设置热点数据永不过期

2. 定时更新

3. 互斥锁

   这是解决缓存穿透比较常用的方法。

   互斥锁（分布式锁）简单来说就是在Redis中根据key获得的value值为空时，先锁上，然后从数据库加载，加载完毕，释放锁。若其他线程也在请求该key时，发现获取锁失败，则睡眠一段时间（比如100ms）后重试。

### 缓存雪崩

Redis 中缓存的数据大面积同时失效，或者 Redis 宕机，大量数据直接请求数据库，压跨数据库

#### 解决方案

1. **保证Redis服务高可用**

   通过哨兵模式和集群（异地多活）实现高可用

2. 限流降级

   在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量

   比如某个key只允许一个线程查询数据和写缓存，其他线程等待

3. 数据预热

   在即将发生大并发访问前，把可能的数据预先访问一遍，这样可能被大量访问的数据就会被加载到缓存中

   并且设置不同的过期时间，让缓存失效的时间尽可能均匀





### 布隆过滤器（TODO）

布隆过滤器是一种数据结构，作用是**可以告诉你某样东西一定不存在或者可能存在**，特点是高效的查询和插入