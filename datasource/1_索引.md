## 数据库索引

直接看这个[MySQL索引底层：B+树详解 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/351240279)

### 索引的底层数据结构

> 不用hash表是因为hash表虽然查找迅速，复杂度为O(1),但不支持顺序和范围查询，数据库中经常需要排序和范围查询，hash表就不合适
>
> 不用二叉树而用B树，是因为数据库的索引存在磁盘中，使用索引时部分读取到内存中，索引树的高度越高磁盘IO次数越多，而B树是将"高瘦"的二叉树变得"矮胖"

#### B-树(B树)&B+树

##### B树（非关系型数据库如MangoDB用的是B树）

> **B树是一种多路平衡查找树，他的一个节点最多包含k个孩子，k称为B树的阶，k的大小取决于磁盘页的大小**
>
> 一个m阶的B树具有如下几个特征：
>
> 1.根结点至少有两个子女。
>
> 2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 <= k <= m
>
> 3.每一个叶子节点都包含k-1个元素，其中 m/2 <= k <= m
>
> 4.所有的叶子结点都位于同一层。
>
> 5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。

![image-20210830125645130](C:\Users\29189\AppData\Roaming\Typora\typora-user-images\image-20210830125645130.png)

**插入**

![image-20210830131357438](C:\Users\29189\AppData\Roaming\Typora\typora-user-images\image-20210830131357438.png)

![image-20210830131419415](C:\Users\29189\AppData\Roaming\Typora\typora-user-images\image-20210830131419415.png)

**删除**

![image-20210830131434840](C:\Users\29189\AppData\Roaming\Typora\typora-user-images\image-20210830131434840.png)

<img src="C:\Users\29189\AppData\Roaming\Typora\typora-user-images\image-20210830131512749.png" alt="image-20210830131512749" style="zoom:110%;" />

##### B+树(MySQL的InnoDB采用的就是B+树)

<img src="C:\Users\29189\AppData\Roaming\Typora\typora-user-images\image-20210830163213822.png" alt="image-20210830163213822" style="zoom:150%;" />

B+树和B-树的主要区别如下：

- B-树内部节点是保存数据的;而B+树内部节点是不保存数据的，只作索引作用，它的叶子节点才保存数据。
- B+树相邻的叶子节点之间是通过链表指针连起来的，B-树却不是。
- 查找过程中，B-树在找到具体的数值以后就结束，而B+树则需要通过索引找到叶子结点中的数据才结束
- B-树中任何一个关键字出现且只出现在一个结点中，而B+树可以出现多次。



> InnoDB采用聚簇索引(聚集索引),其数据文件本身就是按照B+树组织的一个索引结构，索引的KEY是数据表的主键，在添加其他辅助索引时，辅助索引的data域(叶子节点)记录主键的值而不是地址，因此走辅助索引是先取出主键的值，再走一遍主索引取到数据

### 二级索引

**二级索引又称为辅助索引，是因为二级索引的叶子节点存储的数据是主键。也就是说，通过二级索引，可以定位主键的位置。**

唯一索引，普通索引，前缀索引等索引属于二级索引。

1. **唯一索引(Unique Key)** ：唯一索引也是一种约束。**唯一索引的属性列不能出现重复的数据，但是允许数据为 NULL，一张表允许创建多个唯一索引。** 建立唯一索引的目的大部分时候都是为了该属性列的数据的唯一性，而不是为了查询效率。
2. **普通索引(Index)** ：**普通索引的唯一作用就是为了快速查询数据，一张表允许创建多个普通索引，并允许数据重复和 NULL。**
3. **前缀索引(Prefix)** ：前缀索引只适用于字符串类型的数据。前缀索引是对文本的前几个字符创建索引，相比普通索引建立的数据更小， 因为只取前几个字符。
4. **全文索引(Full Text)** ：全文索引主要是为了检索大文本数据中的关键字的信息，是目前搜索引擎数据库使用的一种技术。Mysql5.6 之前只有 MYISAM 引擎支持全文索引，5.6 之后 InnoDB 也支持了全文索引。

### 覆盖索引

如果一个索引包含（或者说覆盖）所有需要查询的字段的值，我们就称之为“覆盖索引”

**覆盖索引即需要查询的字段正好是索引的key，那么直接根据该索引，就可以查到数据了， 而无需回表查询。**

